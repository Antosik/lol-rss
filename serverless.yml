service: riot-rss

app: riot-rss
org: antosik

plugins:
  - serverless-python-requirements

custom:
  S3_BUCKET: ${opt:s3_bucket, "antosik-lol-rss"}
  S3_BUCKET_ARN: arn:aws:s3:::${self:custom.S3_BUCKET}
  S3_RESOURCES: ${self:custom.S3_BUCKET_ARN}/*
  pythonRequirements:
    dockerizePip: non-linux
    layer: true

provider:
  name: aws
  runtime: python3.7
  region: ${opt:region, 'eu-central-1'}
  stage: ${opt:stage, 'dev'}
  timeout: 300
  environment:
    BUCKET_NAME: ${self:custom.S3_BUCKET}
    S3_REGION: ${self:provider.region}
  tracing:
    lambda: true

  iamRoleStatements:
    - Effect: Allow
      Action:
        - s3:PutObject
      Resource: ${self:custom.S3_RESOURCES}

package:
  exclude:
    - node_modules/**
    - __pycache__/**
    - .requirements/**
    - venv/**
    - README.md
    - package.json
    - package-lock.json
    - requirements.txt
    - '*.xml'

functions:
  lolesports:
    handler: handlers/lol/esports.handle
    events:
      - schedule: rate(15 minutes)
    layers:
      - {Ref: PythonRequirementsLambdaLayer}
  lolstatus:
    handler: handlers/lol/status.handle
    events:
      - schedule: rate(15 minutes)
    layers:
      - {Ref: PythonRequirementsLambdaLayer}
  lolnews:
    handler: handlers/lol/news.handle
    events:
      - schedule: rate(15 minutes)
    layers:
      - {Ref: PythonRequirementsLambdaLayer}
  valorantnews:
    handler: handlers/valorant/news.handle
    events:
      - schedule: rate(15 minutes)
    layers:
      - {Ref: PythonRequirementsLambdaLayer}